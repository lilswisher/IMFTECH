<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>imformant.xyz</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: black;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      width: 100%;
      max-width: 90vw;
    }

    h1 {
      text-transform: lowercase;
      font-weight: bold;
      transition: font-size 0.3s;
    }

    .main-title {
      font-size: 3vw;
    }

    .workspace-title {
      font-size: 1.5em;
    }

    #backArrow {
      width: 30px;
      height: 30px;
      cursor: pointer;
      position: absolute;
      top: 20px;
      left: 20px;
      display: none;
      transition: width 0.3s, height 0.3s;
    }

    @media (max-width: 1024px) {
      #backArrow {
        width: 20px;
        height: 20px;
      }
    }

    @media (max-width: 768px) {
      #backArrow {
        width: 15px;
        height: 15px;
      }
    }

    #upload {
      display: none;
    }

    .upload-label {
      padding: 15px 30px;
      font-size: 1.5em;
      font-weight: bold;
      color: black;
      background-color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s;
      text-align: center;
    }

    .upload-label:hover {
      background-color: #e0e0e0;
      transform: scale(1.05);
    }

    .social-media {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .social-media img {
      width: 40px;
      height: 40px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .social-media img:hover {
      transform: scale(1.1);
    }

    #editorContainer {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 2vw;
      margin-top: 2vh;
      width: 100%;
      max-width: 60vw;
      height: auto;
    }

    #editor {
      position: relative;
      width: 100%;
      max-width: 100%;
      height: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden; /* Clips the overlays within the editor */
    }

    #uploadedImage {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: none;
      max-height: 60vh;
      transition: filter 0.3s;
    }

    #overlayText, #overlayImage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.6);
      font-size: 2.5vw;
      color: white;
      display: none;
      pointer-events: none;
      transition: transform 0.3s, filter 0.3s;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      align-items: flex-start;
    }

    button {
      width: 150px;
      padding: 10px;
      font-size: 1em;
      background-color: black;
      color: white;
      border: 2px solid white;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: white;
      color: black;
    }

    .active-button {
      background-color: white;
      color: black;
    }

    .stencil-options, .sticker-options {
      display: flex;
      flex-direction: column;
      gap: 5px;
      position: absolute;
      top: 100%;
      left: 0;
      padding: 10px;
      background-color: black;
      border: 2px solid white;
      border-radius: 8px;
      max-height: 0;
      opacity: 0;
      overflow-y: auto;
      transition: max-height 0.3s ease, opacity 0.3s ease;
    }

    .stencil-options.show, .sticker-options.show {
      max-height: 500px;
      opacity: 1;
    }

    .slider-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
      width: 220px;
      margin-right: 25px;
    }

    .slider-container label {
      font-size: 1em;
      margin-bottom: 5px;
    }

    .slider-control {
      display: flex;
      align-items: center;
      gap: 5px;
      justify-content: flex-end;
    }

    .slider-container input[type="range"], .slider-container select {
      width: 160px;
    }

    .slider-container, #downloadBtn, #stencilGroup, #stickerGroup {
      display: none;
    }

    #downloadBtn {
      margin-top: 15px;
    }

    @media (max-width: 768px) {
      .main-title {
        font-size: 4vw;
      }

      #editorContainer {
        flex-direction: column;
        width: 100vw;
        height: 100vh;
        max-width: 90vw;
      }

      #uploadedImage {
        max-height: 50vh;
      }

      .slider-container {
        width: 90vw;
      }

      button {
        width: 100%;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <img id="backArrow" src="backarrow-icon.png" alt="Back" onclick="resetEditor()">

  <div class="container">
    <h1 id="mainTitle" class="main-title">imformant.xyz</h1>
    
    <label for="upload" class="upload-label" id="uploadLabel">UPLOAD</label>
    <input type="file" id="upload" accept="image/*">

    <div class="social-media" id="socialMediaLinks">
      <a href="https://warpcast.com/~/channel/imf" target="_blank">
        <img src="farcaster-icon.png" alt="farcaster-icon">
      </a>
      <a href="https://x.com/intlmemefund?s=21" target="_blank">
        <img src="twitter-icon.png" alt="Twitter">
      </a>
      <a href="https://imf.bz" target="_blank">
        <img src="imf-icon.png" alt="imfwebsite">
      </a>
    </div>

    <div id="editorContainer">
      <div class="slider-container" id="sliderControls">
        <div class="slider-control">
          <label for="xSlider">X</label>
          <input type="range" id="xSlider" min="0" max="100" value="50" oninput="updateOverlayPosition()">
        </div>
        <div class="slider-control">
          <label for="ySlider">Y</label>
          <input type="range" id="ySlider" min="0" max="100" value="50" oninput="updateOverlayPosition()">
        </div>
        <div class="slider-control">
          <label for="sizeSlider">Size</label>
          <input type="range" id="sizeSlider" min="1" max="5" value="2" step="0.1" oninput="updateOverlaySize()">
        </div>
        <div class="slider-control">
          <label for="rotationSlider">Rotation</label>
          <input type="range" id="rotationSlider" min="0" max="360" value="0" oninput="updateOverlayRotation()">
        </div>
        <div class="slider-control">
          <label for="filterSelect">Filter</label>
          <select id="filterSelect" onchange="applyFilter()">
            <option value="none">None</option>
            <option value="mosaic">Blur</option>
            <option value="blackWhite">Grayscale</option>
            <option value="invert">Invert</option>
            <option value="contrast">High Contrast</option>
          </select>
        </div>
      </div>

      <div id="editor">
        <img id="uploadedImage" alt="Upload an image to edit" />
        <div id="overlayText">IMF</div>
        <img id="overlayImage" alt="Sticker overlay">
      </div>

      <div class="button-group" id="stencilGroup">
        <button id="stencilButton" onclick="toggleDropdown('stencilOptions', 'stickerOptions')">Stencils</button>
        <div class="stencil-options" id="stencilOptions">
          <button id="italicizeButton" onclick="toggleItalic()">Italicize</button>
          <button id="boldButton" onclick="toggleBold()">Bold</button>
          <button onclick="setOverlayText('IMF')">IMF</button>
          <button onclick="setOverlayText('MEME HARDER')">MEME HARDER</button>
          <button onclick="setOverlayText('IMFORMANT')">IMFORMANT</button>
          <button onclick="setOverlayText('MEME ON A MISSION')">MEME ON A MISSION</button>
          <button onclick="setOverlayText('pre-rich')">pre-rich</button>
          <button onclick="setOverlayText('$MONEY')">$MONEY</button>
          <button onclick="setOverlayText('$IMF')">$IMF</button>
          <button onclick="setOverlayText('Gmoney')">Gmoney</button>
          <button onclick="setOverlayText('COINSORTIUM')">COINSORTIUM</button>
        </div>

        <button id="stickerButton" onclick="toggleDropdown('stickerOptions', 'stencilOptions')">Stickers</button>
        <div class="sticker-options" id="stickerOptions">
          <button onclick="applySticker('hattech.png')">Hat Tech</button>
          <button onclick="applySticker('moneyblack.png')">Money Logo</button>
          <button onclick="applySticker('globewhiteblack.png')">Globe #1</button>
          <button onclick="applySticker('globeredblack.png')">Globe #2</button>
          <button onclick="applySticker('globewhitered.png')">Globe #3</button>
        </div>
      </div>
    </div>

    <button id="downloadBtn">Download</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let activeOverlay = 'stencil';

    document.getElementById('upload').addEventListener('change', handleImageUpload);
    document.getElementById('downloadBtn').addEventListener('click', downloadImage);

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const imgElement = document.getElementById('uploadedImage');
        imgElement.src = e.target.result;
        imgElement.style.display = 'block';

        document.body.style.overflow = 'auto';
        document.getElementById("mainTitle").classList.replace("main-title", "workspace-title");
        document.getElementById("uploadLabel").style.display = "none";
        document.getElementById("socialMediaLinks").style.display = "none";
        document.getElementById("backArrow").style.display = "inline";
        document.getElementById("sliderControls").style.display = "flex";
        document.getElementById("stencilGroup").style.display = "flex";
        document.getElementById("downloadBtn").style.display = "block";
      };
      reader.readAsDataURL(file);
    }

    function toggleDropdown(openId, closeId) {
      const openDropdown = document.getElementById(openId);
      const closeDropdown = document.getElementById(closeId);
      openDropdown.classList.toggle('show');
      closeDropdown.classList.remove('show');
      activeOverlay = openId === 'stencilOptions' ? 'stencil' : 'sticker';
      resetOverlaySettings();
    }

    function resetOverlaySettings() {
      document.getElementById("sizeSlider").value = 2;
      document.getElementById("xSlider").value = 50;
      document.getElementById("ySlider").value = 50;
      document.getElementById("rotationSlider").value = 0;
      updateOverlayPosition();
      updateOverlaySize();
      updateOverlayRotation();
    }

    function setOverlayText(text) {
      const overlayText = document.getElementById('overlayText');
      overlayText.innerText = text;
      overlayText.style.display = 'block';
      document.getElementById('overlayImage').style.display = 'none';
      resetOverlaySettings();
    }

    function toggleItalic() {
      const italicButton = document.getElementById('italicizeButton');
      const overlayText = document.getElementById('overlayText');
      overlayText.style.fontStyle = (overlayText.style.fontStyle === 'italic') ? 'normal' : 'italic';
      italicButton.classList.toggle('active-button');
    }

    function toggleBold() {
      const boldButton = document.getElementById('boldButton');
      const overlayText = document.getElementById('overlayText');
      overlayText.style.fontWeight = (overlayText.style.fontWeight === 'bold') ? 'normal' : 'bold';
      boldButton.classList.toggle('active-button');
    }

    function applySticker(imageSrc) {
      const overlayImage = document.getElementById('overlayImage');
      overlayImage.src = imageSrc;
      overlayImage.style.display = 'block';
      document.getElementById('overlayText').style.display = 'none';

      overlayImage.style.width = "20%";
      overlayImage.style.height = "auto";

      resetOverlaySettings();
    }

    function updateOverlayPosition() {
      const x = document.getElementById('xSlider').value;
      const y = document.getElementById('ySlider').value;
      const activeElement = activeOverlay === 'stencil' ? document.getElementById('overlayText') : document.getElementById('overlayImage');
      activeElement.style.left = `${x}%`;
      activeElement.style.top = `${y}%`;
    }

    function updateOverlaySize() {
      const size = document.getElementById('sizeSlider').value;
      const activeElement = activeOverlay === 'stencil' ? document.getElementById('overlayText') : document.getElementById('overlayImage');
      activeElement.style.transform = `translate(-50%, -50%) scale(${size}) rotate(${document.getElementById('rotationSlider').value}deg)`;
    }

    function updateOverlayRotation() {
      const rotation = document.getElementById('rotationSlider').value;
      const activeElement = activeOverlay === 'stencil' ? document.getElementById('overlayText') : document.getElementById('overlayImage');
      activeElement.style.transform = `translate(-50%, -50%) scale(${document.getElementById('sizeSlider').value}) rotate(${rotation}deg)`;
    }

    function applyFilter() {
      const filterSelect = document.getElementById('filterSelect').value;
      const imgElement = document.getElementById('uploadedImage');
      const overlayImage = document.getElementById('overlayImage');

      let filter = 'none';
      if (filterSelect === 'mosaic') {
        filter = 'blur(5px)';
      } else if (filterSelect === 'blackWhite') {
        filter = 'grayscale(100%)';
      } else if (filterSelect === 'invert') {
        filter = 'invert(100%)';
      } else if (filterSelect === 'contrast') {
        filter = 'contrast(200%)';
      }

      imgElement.style.filter = filter;
      overlayImage.style.filter = filter;
    }

    function downloadImage() {
      const editor = document.getElementById('editor');
      html2canvas(editor, { backgroundColor: null }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = 'edited-image.png';
        link.click();
      });
    }

    function resetEditor() {
      document.getElementById('uploadedImage').style.display = 'none';
      document.getElementById('mainTitle').classList.replace("workspace-title", "main-title");
      document.getElementById("uploadLabel").style.display = "inline-block";
      document.getElementById("socialMediaLinks").style.display = "flex";
      document.getElementById("backArrow").style.display = "none";
      document.getElementById("sliderControls").style.display = "none";
      document.getElementById("stencilGroup").style.display = "none";
      document.getElementById("downloadBtn").style.display = "none";
      document.getElementById("overlayText").style.display = "none";
      document.getElementById("overlayText").style.fontStyle = "normal";
      document.getElementById("overlayText").style.fontWeight = "normal";
      document.getElementById("overlayImage").style.display = "none";
      document.getElementById("upload").value = '';
    }
  </script>
</body>
</html>
